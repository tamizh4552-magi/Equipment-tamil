<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>View Requests</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light p-4">

<div class="container">
<h3 class="mb-4">Submitted Requests</h3>
<div id="out"></div>

<a href="index.html" class="btn btn-secondary mt-3">‚Üê Back</a>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzU4s77fEtKRw8M3GKcyWJkemQ1y4zD_OHsLEGjOFqwC3Oc8ZowTxCMdNI0zBcz4cdaJA/exec";

fetch(API)
.then(r => r.json())
.then(d => show(d))
.catch(e => alert("Fetch failed"));

function show(d){
  let html = "";

  d.requests.forEach(r => {
    const items = d.products.filter(p =>
      p["Submitted By User ID"] === r["User ID"] &&
      String(p["Timestamp"]) === String(r["Timestamp"])
    );

    html += `
    <div class="card mb-3">
      <div class="card-body">
        <b>${r.Name}</b> (${r["User ID"]})<br>
        ${r.Email}<br><br>

        <table class="table table-sm table-bordered">
          <tr><th>Product</th><th>Size</th><th>Qty</th></tr>
          ${items.map(i=>`
            <tr>
              <td>${i.Product}</td>
              <td>${i.Size}</td>
              <td>${i.Qty}</td>
            </tr>`).join("")}
        </table>
      </div>
    </div>`;
  });

  document.getElementById("out").innerHTML = html || "No data";
}
</script>

</body>
</html>
