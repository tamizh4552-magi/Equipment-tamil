<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>View Submissions</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
    background:#f4f6f9;
    padding:30px;
}
.card{
    border-radius:15px;
}
</style>
</head>

<body>

<div class="container">
<h3 class="mb-4">Submitted Requests</h3>

<div id="dataArea"></div>

<a href="index.html" class="btn btn-secondary mt-3">‚Üê Back to Form</a>
</div>

<script>
const SCRIPT_URL = "1TQAhQNUnqdiEGgH_ORaX58DVHHTgcGmMzEZSyMO3UB0";

fetch(SCRIPT_URL)
.then(res => res.json())
.then(data => renderData(data))
.catch(err => alert(err));

function renderData(data) {

  let html = "";

  data.requests.forEach(req => {

    const relatedProducts = data.products.filter(p =>
      p["Submitted By User ID"] === req["User ID"] &&
      String(p["Timestamp"]) === String(req["Timestamp"])
    );

    html += `
    <div class="card mb-4 shadow-sm">
      <div class="card-body">
        <h5>${req["Name"]} (${req["User ID"]})</h5>
        <p class="mb-1"><b>Email:</b> ${req["Email"]}</p>
        <p class="mb-1"><b>Phone:</b> ${req["Phone"]}</p>
        <p class="mb-1"><b>Date:</b> ${req["Date"]}</p>
        <p class="mb-2"><b>Approved To:</b> ${req["Approved To"]}</p>

        <table class="table table-sm table-bordered mt-3">
          <thead class="table-dark">
            <tr>
              <th>Product</th>
              <th>Size</th>
              <th>Qty</th>
            </tr>
          </thead>
          <tbody>
            ${relatedProducts.map(p => `
              <tr>
                <td>${p["Product"]}</td>
                <td>${p["Size"]}</td>
                <td>${p["Qty"]}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      </div>
    </div>`;
  });

  document.getElementById("dataArea").innerHTML = html || "No data found";
}
</script>

</body>
</html>
