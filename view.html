<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Submitted Requests</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body {
    background: #f0f2f5;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding: 20px;
}

h3 {
    color: #343a40;
    margin-bottom: 20px;
}

.top-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
}

.btn-custom {
    background-color: #0d6efd;
    color: #fff;
    font-weight: 600;
    border-radius: 6px;
    padding: 10px 20px;
    text-decoration: none;
    transition: 0.3s;
}
.btn-custom:hover {
    background-color: #0b5ed7;
    color: #fff;
}

.table th {
    background-color: #e9ecef;
    font-weight: 600;
}
.table-striped > tbody > tr:nth-of-type(odd) {
    background-color: #f8f9fa;
}

.no-requests {
    text-align: center;
    font-style: italic;
    color: #6c757d;
    margin-top: 50px;
    font-size: 1.1rem;
}
</style>
</head>
<body>

<div class="container">
    <h3>üìù Submitted Safety Equipment Requests</h3>
    <div class="top-bar">
        <a href="index.html" class="btn btn-secondary">‚¨Ö Back to Form</a>
        <!-- <a href="add_request.html" class="btn-custom">‚ûï Add New Request</a> -->
    </div>

    <!-- Consolidated Table -->
    <div class="table-responsive">
        <table class="table table-light table-bordered table-striped">
            <thead class="thead-light">
                <tr>
                    <th>Name</th>
                    <th>User ID</th>
                    <th>Date</th>
                    <th>Phone</th>
                    <th>Team Lead Name</th>
                    <th>Product</th>
                    <th>Size</th>
                    <th>Qty</th>
                </tr>
            </thead>
            <tbody id="table-body">
                <!-- Dynamic rows will be inserted here -->
            </tbody>
        </table>
    </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbxQ3D7526pCCKzuBtYiqBz3HiF_-ltzHxXCo3osKpjvLWQVtCLQASBIe5kmqkg-0OA5/exec?action=view";

async function loadRequests() {
    try {
        const res = await fetch(API);
        const data = await res.json();
        const tableBody = document.getElementById("table-body");

        if (!data || data.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="8" class="text-center">No requests submitted yet.</td></tr>';
            return;
        }

        // Populate table
        tableBody.innerHTML = data.map(r => 
    r.items.map(i => `
        <tr>
            <td>${r.name}</td>
            <td>${r.userid}</td>
            <td>${new Date(r.timestamp).toISOString().split('T')[0]}</td>
            <td>${r.phone}</td>
            <td>${r.team_lead}</td>
            <td>${i.product}</td>
            <td>${i.size}</td>
            <td>${i.qty}</td>
        </tr>
    `).join('')
).join('');


    } catch (err) {
        tableBody.innerHTML = `<tr><td colspan="8" class="text-danger text-center">Error loading requests: ${err.message}</td></tr>`;
        console.error(err);
    }
}

loadRequests();
</script>

</body>
</html>
