<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Submitted Requests</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body {
    background: #f4f6f8;
    padding: 20px;
    font-family: Arial, sans-serif;
}
.card {
    margin-bottom: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.card-header {
    background: #2b5876;
    color: #fff;
    font-weight: bold;
}
.table th, .table td {
    vertical-align: middle;
}
</style>
</head>
<body>

<div class="container">
    <h3 class="mb-4">üìù Submitted Safety Equipment Requests</h3>
    <a href="index.html" class="btn btn-secondary mb-3">‚¨Ö Back to Form</a>
    <div id="requests"></div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbykTtkU0DpfqjxlaPyyag0ycKLYvoSBWRXQe2xn0GXbUqD6wG2VboYulfr4KWM-1R5g/exec?action=view";

async function loadRequests() {
    try {
        const res = await fetch(API);
        const data = await res.json();
        const container = document.getElementById("requests");

        if (!data || data.length === 0) {
            container.innerHTML = '<p>No requests submitted yet.</p>';
            return;
        }

        container.innerHTML = data.map(r => `
            <div class="card">
                <div class="card-header">
                    ${r.name} (${r.userid}) - ${new Date(r.timestamp).toLocaleString()}
                </div>
                <div class="card-body">
                    <p><b>Team Lead:</b> ${r.team_lead}</p>
                    <p><b>Approved To:</b> ${r.approved_to}</p>
                    <p><b>Phone:</b> ${r.phone}</p>
                    <p><b>Request Date:</b> ${r.date}</p>

                    <h6 class="mt-3">Requested Items:</h6>
                    <table class="table table-bordered">
                        <thead>
                            <tr class="table-secondary">
                                <th>Product</th>
                                <th>Size</th>
                                <th>Qty</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${r.items.map(i => `
                                <tr>
                                    <td>${i.product}</td>
                                    <td>${i.size}</td>
                                    <td>${i.qty}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        `).join('');

    } catch (err) {
        document.getElementById("requests").innerHTML = `<p class="text-danger">Error loading requests: ${err.message}</p>`;
        console.error(err);
    }
}

loadRequests();
</script>

</body>
</html>
