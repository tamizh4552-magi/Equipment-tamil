<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Submitted Safety Requests</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- DataTables -->
<link href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css" rel="stylesheet">

<style>
body{
    background:#f4f6f9;
    font-family:"Segoe UI",system-ui,sans-serif;
    padding:20px;
}
.page-header{
    background:#1f2937;
    color:#fff;
    padding:18px 22px;
    border-radius:14px;
    margin-bottom:20px;
}
.action-bar{
    display:flex;
    justify-content:space-between;
    gap:12px;
    background:#fff;
    padding:14px;
    border-radius:14px;
    margin-bottom:15px;
    flex-wrap:wrap;
}
.search-box{max-width:280px}
.btn-back{background:#6b7280;color:#fff}
.btn-stock{background:#2563eb;color:#fff}
.btn-excel{background:#16a34a;color:#fff}
.btn-pdf{background:#dc2626;color:#fff}

.card{
    border:none;
    border-radius:16px;
    box-shadow:0 10px 25px rgba(0,0,0,.08);
}
.table thead{
    background:#2563eb;
    color:#fff;
    font-size:.85rem;
    text-transform:uppercase;
}
</style>
</head>

<body>
<div class="container">

<div class="page-header">
    <h4>üìù Submitted Safety Equipment Requests</h4>
    <small>Search, sort & export PPE requests</small>
</div>

<!-- ACTION BAR -->
<div class="action-bar">
    <a href="index.html" class="btn btn-back">‚¨Ö Back</a>

    <input type="text" id="searchInput" class="form-control search-box" placeholder="üîç Search...">

    <div class="d-flex gap-2">
        <a href="product-stock.html" class="btn btn-stock">üì¶ Product Stock</a>
        <button id="excelBtn" class="btn btn-excel">‚¨á Excel</button>
        <button id="pdfBtn" class="btn btn-pdf">‚¨á PDF</button>
    </div>
</div>

<!-- TABLE -->
<div class="card p-3">
<div class="table-responsive">
<table id="requestsTable" class="table table-striped table-bordered w-100">
    <thead>
        <tr>
            <th>Name</th>
            <th>User ID</th>
            <th>Date</th>
            <th>Phone</th>
            <th>Supervisor</th>
            <th>Product</th>
            <th>Size</th>
            <th>Qty</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>
</div>
</div>

</div>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>

<script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>

<script>
const API = "https://script.google.com/macros/s/AKfycbxkoIQim-2lA5IESzMuL0_Sq23yRhBnNQgmfBR4GPL5WVFvJ-mMPhwRVfBECj-pQj20/exec?action=view";
let table;

async function loadRequests(){
    const res = await fetch(API);
    const data = await res.json();
    const tbody = $("#requestsTable tbody");

    let rows=[];
    data.forEach(r=>{
        r.items.forEach(i=>{
            rows.push(`
                <tr>
                    <td>${r.name}</td>
                    <td>${r.userid}</td>
                    <td>${new Date(r.timestamp).toISOString().split('T')[0]}</td>
                    <td>${r.phone}</td>
                    <td>${r.team_lead}</td>
                    <td>${i.product}</td>
                    <td>${i.size}</td>
                    <td>${i.qty}</td>
                </tr>
            `);
        });
    });

    tbody.html(rows.join(""));

    table = $("#requestsTable").DataTable({
        pageLength:10,
        responsive:true,
        dom:'Bfrtip',
        buttons:[
            {extend:'excelHtml5', title:'Safety_Requests'},
            {extend:'pdfHtml5', title:'Safety Requests', orientation:'landscape'}
        ]
    });

    // Custom search box
    $("#searchInput").on("keyup", function(){
        table.search(this.value).draw();
    });

    // External buttons
    $("#excelBtn").click(()=>table.button('.buttons-excel').trigger());
    $("#pdfBtn").click(()=>table.button('.buttons-pdf').trigger());
}

loadRequests();
</script>
</body>
</html>
