<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Product Stock</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
  background:#f4f6f9;
  font-family:"Segoe UI",system-ui,sans-serif;
  padding:20px;
}

/* ===== HEADER ===== */
.page-header{
  background:#1f2937;
  color:#fff;
  padding:18px 22px;
  border-radius:14px;
  margin-bottom:20px;
}

.page-header h4{
  margin:0;
  font-weight:700;
}

.page-header small{
  opacity:.85;
}

/* ===== ACTION BAR ===== */
.action-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  background:#ffffff;
  padding:14px;
  border-radius:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.06);
  margin-bottom:15px;
  flex-wrap:wrap;
}

/* ===== SEARCH ===== */
.search-box{
  max-width:280px;
}

/* ===== BUTTONS ===== */
.btn-back{
  background:#6b7280;
  color:#fff;
  font-weight:600;
  border-radius:10px;
}

.btn-excel{
  background:#16a34a;
  color:#fff;
  font-weight:700;
  border-radius:10px;
}

.btn-pdf{
  background:#dc2626;
  color:#fff;
  font-weight:700;
  border-radius:10px;
}

/* ===== CARD ===== */
.card{
  border:none;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}

/* ===== TABLE ===== */
.table thead{
  background:#2563eb;
  color:#fff;
  font-size:.85rem;
  text-transform:uppercase;
}

.table td{
  vertical-align:middle;
  font-size:.9rem;
}

/* ===== STOCK STATUS ===== */
.stock-ok{
  background:#dcfce7 !important;
  font-weight:700;
}

.stock-low{
  background:#fef3c7 !important;
  font-weight:700;
}

.stock-none{
  background:#fee2e2 !important;
  font-weight:700;
}

/* ===== MOBILE ===== */
@media(max-width:768px){
  .action-bar{
    flex-direction:column;
    align-items:stretch;
  }
  .search-box{
    max-width:100%;
  }
}
</style>
</head>

<body>

<div class="container">

<!-- HEADER -->
<div class="page-header">
  <h4>ðŸ“¦ Product Stock</h4>
  <small>Live inventory status & availability</small>
</div>

<!-- ACTION BAR -->
<div class="action-bar">

  <a href="index.html" class="btn btn-back">
    â¬… Back
  </a>

  <input type="text" id="search"
         class="form-control search-box"
         placeholder="ðŸ” Search product / size"
         onkeyup="filterTable()">

  <div class="d-flex gap-2 flex-wrap">
    <button class="btn btn-excel" onclick="exportCSV()">
      â¬‡ Export Excel
    </button>

    <button class="btn btn-pdf" onclick="exportPDF()">
      â¬‡ Download PDF
    </button>
  </div>
</div>

<!-- TABLE CARD -->
<div class="card">
<div class="table-responsive">
<table class="table table-bordered table-striped mb-0" id="stockTable">
<thead>
<tr>
  <th>Product</th>
  <th>Size</th>
  <th>Stock</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>
</div>

</div>

<!-- PDF LIBRARIES -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

<script>
const API = "https://script.google.com/macros/s/AKfycbxkoIQim-2lA5IESzMuL0_Sq23yRhBnNQgmfBR4GPL5WVFvJ-mMPhwRVfBECj-pQj20/exec?action=products";

async function loadStock(){
  const res = await fetch(API);
  const data = await res.json();
  const tbody = document.getElementById("tbody");

  tbody.innerHTML = data.map(p=>{
    let cls="stock-ok";
    if(p.stock==0) cls="stock-none";
    else if(p.stock<=5) cls="stock-low";

    return `
      <tr class="${cls}">
        <td>${p.product}</td>
        <td>${p.size}</td>
        <td>${p.stock}</td>
      </tr>
    `;
  }).join("");
}
loadStock();

/* SEARCH */
function filterTable(){
  const v=document.getElementById("search").value.toLowerCase();
  document.querySelectorAll("#stockTable tbody tr")
    .forEach(r=>r.style.display=r.innerText.toLowerCase().includes(v)?"":"none");
}

/* EXPORT CSV */
function exportCSV(){
  let csv=[];
  document.querySelectorAll("#stockTable tr").forEach(r=>{
    if(r.style.display==="none") return;
    csv.push([...r.children].map(c=>`"${c.innerText}"`).join(","));
  });
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv.join("\n")],{type:"text/csv"}));
  a.download="Product_Stock.csv";
  a.click();
}

/* EXPORT PDF */
function exportPDF(){
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF("p","mm","a4");

  let body=[];
  document.querySelectorAll("#stockTable tbody tr").forEach(r=>{
    if(r.style.display==="none") return;
    body.push([...r.children].map(td=>td.innerText));
  });

  doc.text("Product Stock Report",14,15);
  doc.autoTable({
    head:[["Product","Size","Stock"]],
    body:body,
    startY:20,
    styles:{fontSize:9},
    theme:"grid"
  });

  doc.save("Product_Stock.pdf");
}
</script>

</body>
</html>

